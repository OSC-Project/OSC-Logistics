//Add dependencies
const express = require('express'),
      superchild = require('superchild'),
      fs = require('fs');

//Creates app
const app = express();
app.use(express.urlencoded({extended : true}));

//Sends form to client
app.get('/', (req, res) => {
  res.sendFile('index.html', {root: __dirname})
})

//Handles form submissions
app.post('/', (req, res) => {
  let filePath = req.body.filePath

  //Creates child process for cat
  let child = superchild('cat ' + filePath);
  //Sets callback for child output line event to call res.write(), sends ouptut to client
  child.on('stdout_line', function (line) {
    res.write(line + '\n');
  });
  //Sets callback for child "exit" event to call res.end(), completes http response
  child.on('exit', function () {
    res.end()
  });
});

//Starts app
app.listen(process.env.port || 8080);
